<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:type" content="article"/>
<title>ardatasc.github.io</title>
<link rel="icon" href="../../favicon.png" type="image/x-icon">
<link rel="preconnect" href="https://fonts.googleapis.com/">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com/">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com/">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&amp;display=swap" rel="stylesheet">
<link rel="stylesheet" href="../../theme.min.7363202e6ba39c3b4caca8b218f6f6631256ed7a41cd2f8bf46550651b07cb31.css" integrity="">
</head>
<body>
  <div class="header">
  <div class="header-content">
  <div class="header-content-title">
  ardatasc
  </div>
  <div class="header-content-nav">
  <div class="header-content-nav-item">
  <a href="c.html">content</a>
  </div>
  <div class="header-content-nav-item">
  <a href="about.html">about</a>
  </div>
  </div>
  </div>
  </div>
<div class="content-container">
<div class="content"><h1 id="clis-serving-uis">CLIs Serving UIs</h1>
<p>Countless times I’ve found myself shipping CLI tooling amongst teams or
co-workers. The challenge of onboarding users to a new CLI is that there’s a
whole new set of commands, subcommands, flags, and arguments for the user to
work with. While my daily workflows are essentially built on CLIs, there’s no
doubting that a UI can ease the on-ramp and usability of your tooling.</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
<iframe src="https://web.archive.org/web/20240228144707if_/https://www.youtube.com/embed/_6B7fSK8NAY" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
<p>When I was working on Tanzu Community Edition at VMware, I saw first hand how
successful a UI could be. The <code>tanzu</code> CLI was responsible for creating
Kubernetes clusters. Rather than having users create multiple YAML files and
learn the implications of various flags, they could launch a UI that took them
through the options.</p>
<p><img src="https://web.archive.org/web/20240228144707im_/https://github.com/vmware-tanzu/community-edition/blob/main/docs/site/content/docs/edge/img/kickstart-amazon-mgmt-cluster.png?raw=true" alt="VMware Tanzu CLI"></p>
<p>This created an excellent on-ramp for a complex tool, while still enabling power
users to do everything through configuration and flags. As you can tell from the
screenshot above, that UI was quite fancy and built using node packages,
Javascript frameworks, etc. So for most of us, we’ll need something with
significantly less overhead.</p>
<p>I believe we can accomplish this using modern languages like Go or Rust. These
languages provide simple means of spinning up web servers along with templating
libraries where we can render HTML based on our underlying data structures.</p>
<p>Today I’m going to look at adding a front-end to <code>proctor</code>, a CLI responsible
for surfacing details around processes and their relationships. The end state
will be a frontend that can be triggered from the CLI and look something like
this:</p>
<p><img src="https://web.archive.org/web/20240228144707im_/https://files.joshrosso.com/img/posts/embedding-ui-cli/cli-to-ui.png" alt="https://files.joshrosso.com/img/posts/embedding-ui-cli/cli-to-ui.png"></p>
<h2 id="architecture">Architecture</h2>
<p>When I create non-trivial CLI tooling. There’s an pattern I tend to repeat over
time. This pattern surfaces in how packages (or libraries) are built. In the
case of <code>proctor</code> it looks like:</p>
<p><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="100%" viewbox="-0.5 -0.5 621 161" content="<mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2023-03-26T16:53:04.837Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36&quot; version=&quot;21.1.1&quot; etag=&quot;xSfRnf3AddJS8jXXref7&quot; type=&quot;device&quot;><diagram name=&quot;Page-1&quot; id=&quot;-HnrrRIlMP5LF_KwZ3sH&quot;>7VnRbtsgFP2aPK4CY8fJY5uk26ROqlRNWx+pTWxaYixMmmRfPxyDHRs3Shu7XqvlJeZwIXDOAS7OCM1W268Cp/EPHhI2ckC4HaH5yHGg4zrqK0d2BTJx3AKIBA11UAXc0T9Eg0CjaxqSrBYoOWeSpnUw4ElCAlnDsBB8Uw9bclb/1RRHxALuAsxs9BcNZaxn4YEK/0ZoFJtfhkDXrLAJ1kAW45BvDiC0GKGZ4FwWT6vtjLCcPMNL0e76hdpyYIIk8pQGWohM7szcSKimqotcyJhHPMFsUaFXgq+TkOQdAFWqYm44TxUIFfhIpNxp3fBacgXFcsV0rRqb2P3O2184ninf6/72hfm2VtqZ0pbKw3aqeG/6VM9Vq7xgGi0pYzPOuNjPD40BnkJf4ZkU/Ikc1DhzfwxAWWOURQopWMqpqfGc8bUINDTWPsQiIpp631YDlhqrxUH4iqjpqRBBGJb0ud471i6NyrhKSPWgtWzXFQ2iaynPR1BnMpw67rDq+B9Bnmn38uybXgqBdwcBKaeJzA56vs0BFWBOq6leS/qsciaNHbUR73resXj1UIygMko5lZO84w27Y9e264ty935hwx7OPhANt7z1cJ4xW+tOZzffLdnqomxiKsldivdT2qi0qS7AS0QueSIP8OX+c5RgPTYiJNnWZnwCU6aBycOMxU02s6mSoTImPkiEXHA+ub5FbsroQ6fshhMAfPQadi89ANye2EXuO7I7sdgt1tmXz8WxMx6Q46nFcURlvH74ZBy7YECOTb+DXWz8V11sGsIB4AHSKhAAcH41e+s5aQ7Fni8pb8qzkN+wCzyeZzXzskb82XkWhP8ddJqDerhIvYuDkNuzgwZ5uTKgEf6VK9trjdC8snVuBGSd+D+7vQ+UKp980pfqd3DSI9i48r7nfQC6FrnnUYsZjRL1zMhSdsOP18g2Ha+FH7+Fn5K0swjybPdJyqjMR3iLgycckawbygJFCBG2PeEDhsRpt+F4cXl9xLh90N9mzzb6URfs2y8DAp4sadTp+h820/cmDYLHnk0w6otg+4UA41FEk8/MMAL9MayK1f9PxWlX/YuHFn8B</diagram></mxfile>" style="background-color: rgb(255, 255, 255);"><defs></defs><g><path d="M 27.5 40 L 27.5 109.9" fill="none" stroke="#2d7600" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 27.5 116.65 L 23 107.65 L 27.5 109.9 L 32 107.65 Z" fill="#2d7600" stroke="#2d7600" stroke-width="3" stroke-miterlimit="10" pointer-events="all"></path><path d="M 55 40 L 55 80 L 205 80 L 205 109.9" fill="none" stroke="#2d7600" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 205 116.65 L 200.5 107.65 L 205 109.9 L 209.5 107.65 Z" fill="#2d7600" stroke="#2d7600" stroke-width="3" stroke-miterlimit="10" pointer-events="all"></path><path d="M 82.5 40 L 82.5 60 L 345 60 L 345 109.9" fill="none" stroke="#2d7600" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 345 116.65 L 340.5 107.65 L 345 109.9 L 349.5 107.65 Z" fill="#2d7600" stroke="#2d7600" stroke-width="3" stroke-miterlimit="10" pointer-events="all"></path><path d="M 110 20 L 194.9 20" fill="none" stroke="#2d7600" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 201.65 20 L 192.65 24.5 L 194.9 20 L 192.65 15.5 Z" fill="#2d7600" stroke="#2d7600" stroke-width="3" stroke-miterlimit="10" pointer-events="all"></path><rect x="0" y="0" width="110" height="40" fill="#60a917" stroke="#2d7600" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignobject pointer-events="none" width="100%" height="100%" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 20px; margin-left: 1px;"><div data-drawio-colors="color: #ffffff; " style="display: flex; box-sizing: border=box font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: jbm; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">CLI</div></div></div></foreignobject><text x="55" y="24" fill="#ffffff" font-family="jbm" font-size="12px" text-anchor="middle">CLI</text></switch></g><rect x="0" y="120" width="110" height="40" fill="#d80073" stroke="#a50040" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignobject pointer-events="none" width="100%" height="100%" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 140px; margin-left: 1px;"><div data-drawio-colors="color: #ffffff; " style="display: flex; box-sizing: border=box font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: jbm; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">plib</div></div></div></foreignobject><text x="55" y="144" fill="#ffffff" font-family="jbm" font-size="12px" text-anchor="middle">plib</text></switch></g><rect x="150" y="120" width="110" height="40" fill="#d80073" stroke="#a50040" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignobject pointer-events="none" width="100%" height="100%" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 140px; margin-left: 151px;"><div data-drawio-colors="color: #ffffff; " style="display: flex; box-sizing: border=box font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: jbm; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">source-lib</div></div></div></foreignobject><text x="205" y="144" fill="#ffffff" font-family="jbm" font-size="12px" text-anchor="middle">source-lib</text></switch></g><rect x="290" y="120" width="110" height="40" fill="#d80073" stroke="#a50040" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignobject pointer-events="none" width="100%" height="100%" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 140px; margin-left: 291px;"><div data-drawio-colors="color: #ffffff; " style="display: flex; box-sizing: border=box font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: jbm; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">github-lib</div></div></div></foreignobject><text x="345" y="144" fill="#ffffff" font-family="jbm" font-size="12px" text-anchor="middle">github-lib</text></switch></g><path d="M 260 40 L 260 90 L 82.5 90 L 82.5 109.9" fill="none" stroke="#001dbc" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 82.5 116.65 L 78 107.65 L 82.5 109.9 L 87 107.65 Z" fill="#001dbc" stroke="#001dbc" stroke-width="3" stroke-miterlimit="10" pointer-events="all"></path><path d="M 260 40 L 260 90 L 232.5 90 L 232.5 109.9" fill="none" stroke="#001dbc" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 232.5 116.65 L 228 107.65 L 232.5 109.9 L 237 107.65 Z" fill="#001dbc" stroke="#001dbc" stroke-width="3" stroke-miterlimit="10" pointer-events="all"></path><path d="M 260 40 L 260 90 L 345 90 L 345 109.9" fill="none" stroke="#001dbc" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 345 116.65 L 340.5 107.65 L 345 109.9 L 349.5 107.65 Z" fill="#001dbc" stroke="#001dbc" stroke-width="3" stroke-miterlimit="10" pointer-events="all"></path><rect x="205" y="0" width="110" height="40" fill="#0050ef" stroke="#001dbc" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignobject pointer-events="none" width="100%" height="100%" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 20px; margin-left: 206px;"><div data-drawio-colors="color: #ffffff; " style="display: flex; box-sizing: border=box font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: jbm; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">UI</div></div></div></foreignobject><text x="260" y="24" fill="#ffffff" font-family="jbm" font-size="12px" text-anchor="middle">UI</text></switch></g><rect x="450" y="30" width="170" height="110" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"></rect><rect x="450" y="0" width="170" height="30" fill="#1ba1e2" stroke="#006eaf" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignobject pointer-events="none" width="100%" height="100%" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 15px; margin-left: 451px;"><div data-drawio-colors="color: #ffffff; " style="display: flex; box-sizing: border=box font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: jbm; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Utility Packages</div></div></div></foreignobject><text x="535" y="19" fill="#ffffff" font-family="jbm" font-size="12px" text-anchor="middle">Utility Packages</text></switch></g><rect x="470" y="45" width="130" height="30" fill="#d80073" stroke="#a50040" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignobject pointer-events="none" width="100%" height="100%" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 60px; margin-left: 471px;"><div data-drawio-colors="color: #ffffff; " style="display: flex; box-sizing: border=box font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: jbm; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">config</div></div></div></foreignobject><text x="535" y="64" fill="#ffffff" font-family="jbm" font-size="12px" text-anchor="middle">config</text></switch></g><rect x="470" y="85" width="130" height="30" fill="#d80073" stroke="#a50040" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignobject pointer-events="none" width="100%" height="100%" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 100px; margin-left: 471px;"><div data-drawio-colors="color: #ffffff; " style="display: flex; box-sizing: border=box font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: jbm; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">logging</div></div></div></foreignobject><text x="535" y="104" fill="#ffffff" font-family="jbm" font-size="12px" text-anchor="middle">logging</text></switch></g></g><switch><g requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"></g><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg></p>
<p>Each piece of core functionality ends up in its own <code>*lib</code> package. This ensure
the library can be imported into other projects and used without interaction of
the CLI and not taking on <a href="https://web.archive.org/web/20240228144707/https://www.notion.so/CLIs-Serving-UIs-fa96c2e73f6148bd8e7c240ad5c08c27">transitive
dependencies</a>
of the CLI. Additionally, by treating the CLI, and eventually UI, as an importer
of the underlying libraries, it forces me to consider what I should be exposing
at the package-level and how my API should be designed.</p>
<p>Once the libraries are in place, the CLI code and UI code become nothing more
than defining user interaction for their respective models. Lastly, there are a
set of packages such as configuration or logging that all packages are allowed
to import, thus these standalone to ensure there aren’t any <a href="https://web.archive.org/web/20240228144707/https://en.wikipedia.org/wiki/Circular_dependency">circular dependency
problems</a>.</p>
<p>For today’s purposes, all of the above pre-exists minus the UI block above.
We’re going to dig into what it’ll look like to hook into the <code>plib</code> (process)
library along with call the UI from the CLI itself. To get an idea for some
functionality we’ll build a UI around, one thing proctor can do is surface known
process, important details about them and their hierarchy. Here are 3 examples
that show the flow a user might go through.</p>
<p>Listing processes:</p>
<pre tabindex="0"><code># proctor ps ls

+--------+-------------------------------------+-----------------------------------------------------------+------------------------------------------------------------------+
|  PID   |                NAME                 |                         LOCATION                          |                               SHA                                |
+--------+-------------------------------------+-----------------------------------------------------------+------------------------------------------------------------------+
|   1422 | wrapper-2.0                         | /usr/lib/xfce4/panel/wrapper-2.0                          | 37422e15cc11ed476eb5019d73e8bf1a00d2c8f63b027b639bfacf864a5fb88a |
|  43233 | chrome_crashpad_handler             | /usr/lib/chromium/chrome_crashpad_handler                 | c8a36670bfd7505e0a58866f9cd8a84a0ade2fca983491e0fb70092646d620af |
|  67956 | bash                                | /usr/bin/bash                                             | 864925e8e16b3c2bc999c77e4959f20b4834e48f49b966e550e00e13dc01f9b7 |
|   1363 | xfce4-panel                         | /usr/bin/xfce4-panel                                      | 069c098a8e5d253b60ddbb9784574b51ff397273f146a21f11fe7b8cfcde3e65 |
|   3259 | bash                                | /usr/bin/bash                                             | 864925e8e16b3c2bc999c77e4959f20b4834e48f49b966e550e00e13dc01f9b7 |
|  58079 | chromium                            | /usr/lib/chromium/chromium                                | 9e49ab8e46367c7229f07a7227753360e39932f276c523a0ddff58fcbbbb0080 |
|   1334 | xfwm4                               | /usr/bin/xfwm4                                            | 024da2825e5d28dcdf73987c36bd28dba183e012f24af61b803e224e6cab7a69 |
+--------+-------------------------------------+-----------------------------------------------------------+------------------------------------------------------------------+
</code></pre><p>Getting details around a process:</p>
<pre tabindex="0"><code># proctor ps get --id 1334 -o json | jq . &gt; ~/clip

{
  &#34;ID&#34;: 1334,
  &#34;BinarySHA&#34;: &#34;024da2825e5d28dcdf73987c36bd28dba183e012f24af61b803e224e6cab7a69&#34;,
  &#34;CommandName&#34;: &#34;xfwm4&#34;,
  &#34;CommandPath&#34;: &#34;/usr/bin/xfwm4&#34;,
  &#34;FlagsAndArgs&#34;: &#34;&#34;,
  &#34;ParentProcess&#34;: 1273,
  &#34;IsKernel&#34;: false,
  &#34;HasPermission&#34;: true,
  &#34;Type&#34;: &#34;linux&#34;,
  &#34;OSSpecific&#34;: {
    &#34;ID&#34;: 1334,
    &#34;FileName&#34;: &#34;(xfwm4)&#34;,
    &#34;State&#34;: &#34;S&#34;,
    &#34;ParentID&#34;: 1273,
    &#34;ProcessGroup&#34;: 1273,
    &#34;SessionID&#34;: 1273,
    &#34;TTY&#34;: 0,
    &#34;TTYProcessGroup&#34;: -1,
    &#34;TaskFlags&#34;: &#34;4194304&#34;,
    &#34;MinorFaultQuantity&#34;: 19523,
    &#34;MinorFaultWithChildQuantity&#34;: 0,
    &#34;MajorFaultQuantity&#34;: 60,
    &#34;MajorFaultWithChildQuantity&#34;: 0,
    &#34;UserModeTime&#34;: 8030,
    &#34;KernalTime&#34;: 5154,
    &#34;UserModeTimeWithChild&#34;: 0,
    &#34;KernalTimeWithChild&#34;: 0,
    &#34;Priority&#34;: 20,
    &#34;Nice&#34;: 0,
    &#34;ThreadQuantity&#34;: 17,
    &#34;ItRealValue&#34;: 0,
    &#34;StartTime&#34;: 1398,
    &#34;VirtualMemSize&#34;: 1937858560,
    &#34;ResidentSetMemSize&#34;: 27973,
    &#34;RSSByteLimit&#34;: 9223372036854776000,
    &#34;StartCode&#34;: &#34;0x55cfe3fca000&#34;,
    &#34;EndCode&#34;: &#34;0x55cfe400750d&#34;,
    &#34;StartStack&#34;: &#34;0x7fff639ef3c0&#34;,
    &#34;ExtendedStackPointerAddress&#34;: 0,
    &#34;ExtendedInstructionPointer&#34;: 0,
    &#34;SignalPendingQuantity&#34;: 0,
    &#34;SignalsBlockedQuantity&#34;: 0,
    &#34;SignalsIgnoredQuantity&#34;: 4096,
    &#34;SiganlsCaughtQuantity&#34;: 16899,
    &#34;PlaceHolder1&#34;: 0,
    &#34;PlaceHolder2&#34;: 0,
    &#34;PlaceHolder3&#34;: 0,
    &#34;ExitSignal&#34;: 17,
    &#34;CPU&#34;: 3,
    &#34;RealtimePriority&#34;: 0,
    &#34;SchedulingPolicy&#34;: 0,
    &#34;TimeSpentOnBlockIO&#34;: 0,
    &#34;GuestTime&#34;: 0,
    &#34;GuestTimeWithChild&#34;: 0,
    &#34;StartDataAddress&#34;: &#34;0x55cfe401a330&#34;,
    &#34;EndDataAddress&#34;: &#34;0x55cfe401d140&#34;,
    &#34;HeapExpansionAddress&#34;: &#34;0x55cfe5803000&#34;,
    &#34;StartCMDAddress&#34;: &#34;0x7fff639efb5e&#34;,
    &#34;EndCMDAddress&#34;: &#34;0x7fff639efba8&#34;,
    &#34;StartEnvAddress&#34;: &#34;0x7fff639efba8&#34;,
    &#34;EndEnvAddress&#34;: &#34;0x7fff639effe9&#34;,
    &#34;ExitCode&#34;: 0
  }
}
</code></pre><p>Retrieve parent/child process relationships:</p>
<pre tabindex="0"><code># proctor ps tree

proctor ps tree 1334
+------+---------------+--------------------------+------------------------------------------------------------------+
| PID  |     NAME      |         LOCATION         |                               SHA                                |
+------+---------------+--------------------------+------------------------------------------------------------------+
| 1334 | xfwm4         | /usr/bin/xfwm4           | 024da2825e5d28dcdf73987c36bd28dba183e012f24af61b803e224e6cab7a69 |
| 1247 | xfce4-session | /usr/bin/xfce4-session   | 0c24d548599567fd6e6395bc24e80949cddb31967d57c2fea5f63bbcccd6055e |
| 1177 | lightdm       | /usr/bin/lightdm         | 2ee123681189b1630549d603be51c650e4d3341116e61a04907b25549c89d888 |
| 1000 | lightdm       | /usr/bin/lightdm         | 2ee123681189b1630549d603be51c650e4d3341116e61a04907b25549c89d888 |
|    1 | systemd       | /usr/lib/systemd/systemd | 5cfc1481f6f476778e22b0edeb418ec8389a2caa5c034334a71f8b4246d8f974 |
+------+---------------+--------------------------+------------------------------------------------------------------+
</code></pre><p>Along with these examples, there’s also some complexity around caching process
data that was retrieved and refreshing that data for a newer set. All of this
will be considered as we build the UI.</p>
<h2 id="creating-the-ui-package">Creating the <code>ui</code> Package</h2>
<p>Throughout these examples, I’ll expose partial code for the sake of highlighting
concepts. To see the full project, please visit
<a href="https://web.archive.org/web/20240228144707/https://github.com/arctir/proctor">https://github.com/arctir/proctor</a>.</p>
<p>First, we’ll create a new <code>ui</code> package and setup a UI struct along with its
constructor.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">UI</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">inspector</span>   <span class="nx">plib</span><span class="p">.</span><span class="nx">Inspector</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// local refrence to process data, such that
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// we don&#39;t always need to retrieve via the
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// inspector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">data</span>        <span class="nx">Data</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// when operations read or refresh process data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// use this lock to ensure the multi-threaded
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// webserver does not mutate something being
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// accessed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">refreshLock</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Data tracks process data and the last time it was
</span></span></span><span class="line"><span class="cl"><span class="c1">// retrieved from the system
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Data</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">LastRefresh</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl">	<span class="nx">PS</span>          <span class="nx">plib</span><span class="p">.</span><span class="nx">Processes</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">DetailKV</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Field</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Value</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">New</span><span class="p">()</span> <span class="o">*</span><span class="nx">UI</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">	<span class="nx">newInspector</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">plib</span><span class="p">.</span><span class="nf">NewInspector</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">newUI</span> <span class="o">:=</span> <span class="nx">UI</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">inspector</span><span class="p">:</span>   <span class="nx">newInspector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">data</span><span class="p">:</span>        <span class="nx">Data</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">refreshLock</span><span class="p">:</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="p">{},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">newUI</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>It may be a bit challenging to grok all the things this code is doing without
looking into <code>proctor</code>, but bear with me — the key is the templated response
we’ll get to in a bit.</p>
<p>The main focus is the UI struct that will hold the state of our UI, underlying
data, and serve HTTP endpoints. A <code>Run()</code> method should be attached to <code>UI</code>,
which registers HTTP handlers (functions) and serves the endpoint.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">port</span>              <span class="p">=</span> <span class="s">&#34;:8080&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">refreshPath</span>       <span class="p">=</span> <span class="s">&#34;/refresh&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">processesPath</span>     <span class="p">=</span> <span class="s">&#34;/process/&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">processesTreePath</span> <span class="p">=</span> <span class="s">&#34;/tree/&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">ui</span> <span class="o">*</span><span class="nx">UI</span><span class="p">)</span> <span class="nf">RunUI</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">handleAllProcesses</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="nx">refreshPath</span><span class="p">,</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">handleRefresh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="nx">processesPath</span><span class="p">,</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">handleProcessDetails</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="nx">processesTreePath</span><span class="p">,</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">handleProcessTree</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;serving at %s&#34;</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nb">panic</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Each <code>http.HandleFunc</code> seen above will have a method that:</p>
<ol>
<li>Understands the request.</li>
<li>Calls <code>plib</code> functionality.</li>
<li>Uses results from <code>plib</code> to parse HTML templates.</li>
<li>Sends the templated response and response code back to the client.</li>
</ol>
<p>With this, we’ll end up with 4 types of requests:</p>
<ul>
<li><code>/</code>: Lists all process on a host.</li>
<li><code>/refresh</code>: Reloads all process on a host; redirects to <code>/</code>.</li>
<li><code>/process/{PID}</code>: Displays all known data about a specific process.</li>
<li><code>/tree/{PID}</code>: Displays the hierarchy of a process.</li>
</ul>
<p>To complete the handlers, we need to implement the 4 above:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// / Logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">ui</span> <span class="o">*</span><span class="nx">UI</span><span class="p">)</span> <span class="nf">handleAllProcesses</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ui</span><span class="p">.</span><span class="nx">refreshLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">refreshLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// retrieve process data from plib.Inspector.GetProcesses
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ui</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">PS</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">inspector</span><span class="p">.</span><span class="nf">GetProcesses</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ui</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">LastRefresh</span> <span class="p">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">inspector</span><span class="p">.</span><span class="nf">GetLastLoadTime</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// create template and parse with plib.Processes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">t</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">createTemplate</span><span class="p">(</span><span class="nx">allProcessesView</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="p">=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// /refresh Logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">ui</span> <span class="o">*</span><span class="nx">UI</span><span class="p">)</span> <span class="nf">handleRefresh</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ui</span><span class="p">.</span><span class="nx">refreshLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">refreshLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// clear process cache and recall /, which forces
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// load of processes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">inspector</span><span class="p">.</span><span class="nf">ClearProcessCache</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;refreshed process cache&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">http</span><span class="p">.</span><span class="nf">Redirect</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusSeeOther</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// /process/{PID} Logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">ui</span> <span class="o">*</span><span class="nx">UI</span><span class="p">)</span> <span class="nf">handleProcessDetails</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">pid</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">getProcessFromPath</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">processesPath</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// create template and render with plib.Process
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">t</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">createTemplate</span><span class="p">(</span><span class="nx">viewProcessDetails</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">PS</span><span class="p">[</span><span class="nx">pid</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// /tree/{PID} Logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">ui</span> <span class="o">*</span><span class="nx">UI</span><span class="p">)</span> <span class="nf">handleProcessTree</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">pid</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">getProcessFromPath</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">processesTreePath</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">hierarchy</span> <span class="o">:=</span> <span class="nf">getProcessHierarchy</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">PS</span><span class="p">,</span> <span class="nx">pid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">createTemplate</span><span class="p">(</span><span class="nx">viewTreeDetails</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">hierarchy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>As you can see, the implementations for the handlers aren’t that involved. This
is thanks <code>plib</code> handling almost all the logic. In fact, the key here is to:</p>
<ul>
<li>Ensure we have a
<a href="https://web.archive.org/web/20240228144707/https://github.com/arctir/proctor/blob/38f4d7be717fecc508a100a71ba3fdfe31fd1a81/plib/process.go#L70">plib.Processes</a>
struct filed up.</li>
<li>Pass it along with a base template to be rendered and returned to the caller.</li>
<li>Use <a href="https://web.archive.org/web/20240228144707/https://pkg.go.dev/sync#Mutex">sync.Mutex</a> to ensure that calls into the
UI don’t mutate during a read.</li>
</ul>
<p>In the above handlers, there are a few convenience functions that are called.
Below you’ll find their implementation with some comments around the intent:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// getProcessHierarchy returns a list of processes starting with the most child
</span></span></span><span class="line"><span class="cl"><span class="c1">// and ending with the most parent. The most child will be the defined by the
</span></span></span><span class="line"><span class="cl"><span class="c1">// pid argument.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">getProcessHierarchy</span><span class="p">(</span><span class="nx">processes</span> <span class="nx">plib</span><span class="p">.</span><span class="nx">Processes</span><span class="p">,</span> <span class="nx">pid</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="nx">plib</span><span class="p">.</span><span class="nx">Process</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">result</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">plib</span><span class="p">.</span><span class="nx">Process</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">currentProcess</span> <span class="o">:=</span> <span class="o">*</span><span class="nx">processes</span><span class="p">[</span><span class="nx">pid</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">currentProcess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">parentProcess</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">processes</span><span class="p">[</span><span class="nx">currentProcess</span><span class="p">.</span><span class="nx">ParentProcess</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">currentProcess</span> <span class="p">=</span> <span class="o">*</span><span class="nx">parentProcess</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">result</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// createTemplate returns a final template with your template (temp) specified
</span></span></span><span class="line"><span class="cl"><span class="c1">// and wrapped with [UIHeader] and [UIFooter].
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">createTemplate</span><span class="p">(</span><span class="nx">temp</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">template</span><span class="p">.</span><span class="nx">Template</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;response&#34;</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Funcs</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">FuncMap</span><span class="p">{</span><span class="s">&#34;pDeets&#34;</span><span class="p">:</span> <span class="nx">getProcessDetails</span><span class="p">}).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">Parse</span><span class="p">(</span><span class="nx">uiHeader</span> <span class="o">+</span> <span class="nx">temp</span> <span class="o">+</span> <span class="nx">uiFooter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">t</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// writeFailure create a client response around a failed request.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">writeFailure</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">w</span><span class="p">.</span><span class="nf">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nf">createTemplate</span><span class="p">(</span><span class="nx">errorView</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">t</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>createTemplate</code> provides a good transition to our next focus, rendering HTML.
This function takes the contents of variables <code>uiHeader</code> and <code>uiFooter</code> and puts
the <code>temp</code> argument (provided by the handler) in between them.</p>
<h2 id="templates">Templates</h2>
<p>The <code>ui</code> variables described in the previous section are stored as <code>const</code>
variables in the source.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">uiHeader</span> <span class="p">=</span> <span class="s">`
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">	&lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">	&lt;style&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		.buttons {
</span></span></span><span class="line"><span class="cl"><span class="s">			margin-bottom: 1rem;
</span></span></span><span class="line"><span class="cl"><span class="s">		}
</span></span></span><span class="line"><span class="cl"><span class="s">		button {
</span></span></span><span class="line"><span class="cl"><span class="s">			background-color: black;
</span></span></span><span class="line"><span class="cl"><span class="s">			color: white;
</span></span></span><span class="line"><span class="cl"><span class="s">			border: 1px solid black;
</span></span></span><span class="line"><span class="cl"><span class="s">			padding: 8px;
</span></span></span><span class="line"><span class="cl"><span class="s">			font-size: 16px;
</span></span></span><span class="line"><span class="cl"><span class="s">			cursor: pointer;
</span></span></span><span class="line"><span class="cl"><span class="s">		}
</span></span></span><span class="line"><span class="cl"><span class="s">		table {
</span></span></span><span class="line"><span class="cl"><span class="s">			border-collapse: collapse;
</span></span></span><span class="line"><span class="cl"><span class="s">			width: 100%;
</span></span></span><span class="line"><span class="cl"><span class="s">		}
</span></span></span><span class="line"><span class="cl"><span class="s">		th, td {
</span></span></span><span class="line"><span class="cl"><span class="s">			border: 1px solid black;
</span></span></span><span class="line"><span class="cl"><span class="s">			padding: 8px;
</span></span></span><span class="line"><span class="cl"><span class="s">			text-align: left;
</span></span></span><span class="line"><span class="cl"><span class="s">		}
</span></span></span><span class="line"><span class="cl"><span class="s">		th {
</span></span></span><span class="line"><span class="cl"><span class="s">			background-color: black;
</span></span></span><span class="line"><span class="cl"><span class="s">			color: white;
</span></span></span><span class="line"><span class="cl"><span class="s">		}
</span></span></span><span class="line"><span class="cl"><span class="s">		.tree-wrapper {
</span></span></span><span class="line"><span class="cl"><span class="s">			padding-top: 10px;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list {
</span></span></span><span class="line"><span class="cl"><span class="s">			list-style: none;
</span></span></span><span class="line"><span class="cl"><span class="s">			padding: 0;
</span></span></span><span class="line"><span class="cl"><span class="s">			margin: 0;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item {
</span></span></span><span class="line"><span class="cl"><span class="s">			position: relative;
</span></span></span><span class="line"><span class="cl"><span class="s">			display: block;
</span></span></span><span class="line"><span class="cl"><span class="s">			min-height: 2em;
</span></span></span><span class="line"><span class="cl"><span class="s">			line-height: 2em;
</span></span></span><span class="line"><span class="cl"><span class="s">			margin-bottom: 10px;
</span></span></span><span class="line"><span class="cl"><span class="s">			padding-left: 21px;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item:before, .tree-list .tree-item:after {
</span></span></span><span class="line"><span class="cl"><span class="s">			content: &#34;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s">			position: absolute;
</span></span></span><span class="line"><span class="cl"><span class="s">			display: block;
</span></span></span><span class="line"><span class="cl"><span class="s">			background-color: #333;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item:before {
</span></span></span><span class="line"><span class="cl"><span class="s">			top: 0;
</span></span></span><span class="line"><span class="cl"><span class="s">			left: 10px;
</span></span></span><span class="line"><span class="cl"><span class="s">			width: 1px;
</span></span></span><span class="line"><span class="cl"><span class="s">			height: calc(100% + 10px);
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item:after {
</span></span></span><span class="line"><span class="cl"><span class="s">			top: 1em;
</span></span></span><span class="line"><span class="cl"><span class="s">			left: 10px;
</span></span></span><span class="line"><span class="cl"><span class="s">			width: 11px;
</span></span></span><span class="line"><span class="cl"><span class="s">			height: 1px;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item:last-child {
</span></span></span><span class="line"><span class="cl"><span class="s">			margin-bottom: 0;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item:last-child:before {
</span></span></span><span class="line"><span class="cl"><span class="s">			height: 1em;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item:first-child:before {
</span></span></span><span class="line"><span class="cl"><span class="s">			top: -10px;
</span></span></span><span class="line"><span class="cl"><span class="s">			height: calc(100% + 20px);
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item &gt; span {
</span></span></span><span class="line"><span class="cl"><span class="s">			display: inline-block;
</span></span></span><span class="line"><span class="cl"><span class="s">			padding: 0 5px;
</span></span></span><span class="line"><span class="cl"><span class="s">			border: 1px solid #333;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">		  .tree-list .tree-item &gt; .tree-list {
</span></span></span><span class="line"><span class="cl"><span class="s">			padding-top: 10px;
</span></span></span><span class="line"><span class="cl"><span class="s">		  }
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">	&lt;/style&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;title&gt;Procotor display&lt;/title&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">	&lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">	&lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">uiFooter</span> <span class="p">=</span> <span class="s">`
</span></span></span><span class="line"><span class="cl"><span class="s">	&lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">viewProcessDetails</span> <span class="p">=</span> <span class="s">`
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;div class=&#34;container&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;div class=&#34;buttons&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;a href=&#34;/&#34;&gt;&lt;button&gt;All Processes&lt;/button&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;a href=&#34;/tree/</span><span class="cp">{{</span><span class="w"> </span><span class="na">.ID</span><span class="w"> </span><span class="cp">}}</span><span class="s">&#34;&gt;&lt;button&gt;Process Hierarchy&lt;/button&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;table&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;th&gt;Field&lt;/th&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;th&gt;Value&lt;/th&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			</span><span class="cp">{{</span><span class="k">range</span><span class="w"> </span><span class="nx">$idx</span><span class="o">,</span><span class="w"> </span><span class="nx">$value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">pDeets</span><span class="w"> </span><span class="cp">}}</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;td&gt;</span><span class="cp">{{</span><span class="w"> </span><span class="nx">$value</span><span class="na">.Field</span><span class="w"> </span><span class="cp">}}</span><span class="s">&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;td&gt;</span><span class="cp">{{</span><span class="w"> </span><span class="nx">$value</span><span class="na">.Value</span><span class="w"> </span><span class="cp">}}</span><span class="s">&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			</span><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;/table&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">viewTreeDetails</span> <span class="p">=</span> <span class="s">`
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;div class=&#34;container&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;div class=&#34;buttons&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;a href=&#34;/&#34;&gt;&lt;button&gt;All Processes&lt;/button&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;div class=&#34;tree-wrapper&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		  	    </span><span class="cp">{{</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">$value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="cp">}}</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">				&lt;ul class=&#34;tree-list&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">					&lt;li class=&#34;tree-item has-sub&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">						&lt;span&gt;&lt;a href=&#34;/process/</span><span class="cp">{{</span><span class="w"> </span><span class="na">.ID</span><span class="w"> </span><span class="cp">}}</span><span class="s">&#34;&gt;</span><span class="cp">{{</span><span class="w"> </span><span class="na">.CommandName</span><span class="w"> </span><span class="cp">}}</span><span class="s"> (</span><span class="cp">{{</span><span class="w"> </span><span class="na">.ID</span><span class="w"> </span><span class="cp">}}</span><span class="s">)&lt;/a&gt;&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">				</span><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">		  	    </span><span class="cp">{{</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="cp">}}</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">					&lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">				&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">				</span><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">allProcessesView</span> <span class="p">=</span> <span class="s">`
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;div class=&#34;container&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;div class=&#34;status&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		 &lt;p&gt;Last Refreshed: </span><span class="cp">{{</span><span class="w"> </span><span class="na">.LastRefresh</span><span class="w"> </span><span class="cp">}}</span><span class="s">&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;div class=&#34;buttons&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;a href=&#34;/refresh&#34;&gt;&lt;button&gt;Refresh&lt;/button&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;table&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;th&gt;PID&lt;/th&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;th&gt;Name&lt;/th&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;th&gt;SHA&lt;/th&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			</span><span class="cp">{{</span><span class="k">range</span><span class="w"> </span><span class="nx">$key</span><span class="o">,</span><span class="w"> </span><span class="nx">$value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="na">.PS</span><span class="cp">}}</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;td&gt;</span><span class="cp">{{</span><span class="nx">$key</span><span class="cp">}}</span><span class="s">&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">				&lt;td&gt;&lt;a href=&#34;process/</span><span class="cp">{{</span><span class="nx">$key</span><span class="cp">}}</span><span class="s">&#34;&gt;</span><span class="cp">{{</span><span class="na">.CommandName</span><span class="cp">}}</span><span class="s">&lt;/a&gt;&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;td&gt;</span><span class="cp">{{</span><span class="na">.BinarySHA</span><span class="cp">}}</span><span class="s">&lt;/td&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;/tr&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            </span><span class="cp">{{</span><span class="k">end</span><span class="cp">}}</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;/table&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">errorView</span> <span class="p">=</span> <span class="s">`
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;div class=&#34;container&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;div class=&#34;status&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;h1&gt;Failed creating requested page.&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;p&gt;Error details </span><span class="cp">{{</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="cp">}}</span><span class="s">&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">			&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">		&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">`</span>
</span></span></code></pre></div><p>At a high-level, <code>uiHeader</code> is holding the CSS and <code>uiFooter</code> the finishing HTML
elements. The expectation is that something like <code>allProcessesView</code> will be
passed in along with a supporting struct to render against. The <code>{{ }}</code> syntax
you’re seeing are Go templates, which can be <a href="https://web.archive.org/web/20240228144707/https://pkg.go.dev/text/template">read about
here</a>.</p>
<p>While I won’t be digging into the features of Go templates today, let’s examine
the plumbing for <code>viewProcessDetails</code>. The end state rendered page looks like
this:</p>
<p><img src="https://web.archive.org/web/20240228144707im_/https://files.joshrosso.com/img/posts/embedding-ui-cli/frontend.png" alt="ui to front-end graphic"></p>
<p>Taking a look at the <code>{{range $idx, $value := . | pDeets }}</code> inside of
<code>viewProcessDetails</code>, you’ll notice it’s looping to create the rows in the
table. The <code>.</code> represents the object that was passed in from the handler
function and <code>pDeets</code> is a mapping to a function we registered. If we look
inside <code>ui.handleProcessDetails</code>, you’ll see that it’s passing an instance of
<a href="https://web.archive.org/web/20240228144707/https://github.com/arctir/proctor/blob/38f4d7be717fecc508a100a71ba3fdfe31fd1a81/plib/process.go#L30">plib.Process</a>,
which is the root object, or <code>.</code>. The <code>. | pDeets</code> is templating syntax that
resolves as passing that <code>plib.Process</code> into the function mapped to <code>pDeets</code>. Go
templates have this weird model of registering functions to make them available
inside your templates. Inside <code>createTemplate</code>, you can see that
<code>getProcessHierarchy</code> is registered as <code>pDeets</code>. And that the argument it
expects is one of <code>plib.Process</code>!</p>
<p>If you’re new to Go templating this all might feel a bit foreign. As such, you
may benefit by just templating out some simple HTML and seeing if you can make
it work. As a final note, if you end up building something with a larger set of
static assets, it may become impossible to keep them stored in variables as I
have. In this case, you can look into <a href="https://web.archive.org/web/20240228144707/https://pkg.go.dev/embed">Go’s embed
package</a> to point at external static assets that can
be compiled into the binary.</p>
<h2 id="registering-a-ui-command">Registering a <code>ui</code> Command</h2>
<p>The final step is to add a <code>ui</code> command to the CLI such that <code>proctor ui</code> can
open a port for a UI to render on. How you introducing this subcommand depends
on how you’re rendering the CLI utility. In Go, most of us use
<a href="https://web.archive.org/web/20240228144707/https://github.com/spf13/cobra">Cobra</a>, and if you want to see how this is
wired up for proctor, visit the <a href="https://web.archive.org/web/20240228144707/https://github.com/arctir/proctor/tree/main/proctor/cmd">cmd
package</a>. For the sake
of this post, here are the relevant functions for that package:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// SetupCLI creates CLI command structure
</span></span></span><span class="line"><span class="cl"><span class="c1">// call this from main
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">SetupCLI</span><span class="p">()</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">proctorCmd</span><span class="p">.</span><span class="nf">AddCommand</span><span class="p">(</span><span class="nx">uiCmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">proctorCmd</span><span class="p">.</span><span class="nf">AddCommand</span><span class="p">(</span><span class="nx">processCmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// more command here, ommited for brevity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="nx">proctorCmd</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">uiCmd</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Use</span><span class="p">:</span>   <span class="s">&#34;ui&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Short</span><span class="p">:</span> <span class="s">&#34;Run the web-based UI&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Run</span><span class="p">:</span>   <span class="nx">runUI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// runUI defines the behavior of running:
</span></span></span><span class="line"><span class="cl"><span class="c1">// `proctor ui ...`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">runUI</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ui</span><span class="p">.</span><span class="nf">New</span><span class="p">().</span><span class="nf">RunUI</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The key takeaway in the above is that the plumbing leads to a call of <code>runUI</code>.
That then creates a New instance of the <code>UI</code> struct and triggers the <code>RunUI()</code>
logic.</p>
<h2 id="closing">Closing</h2>
<p>In conclusion, embedding a UI into your CLI can greatly reduce the ramp-up time
for users and provide an alternative way to interact with the tooling. By using
languages like Go or Rust, we can easily produce frontends for our users. This
certainly isn’t a model that will scale for non-trivial web interfaces or large
scale web services, but it definitely scratches an itch in the CLI tooling
space.</p>
</div>
<div class="content-toc">
<h3>Contents</h3>
<nav id="TableOfContents">
<ul>
<li><a href="index.html#architecture">Architecture</a></li>
<li><a href="index.html#creating-the-ui-package">Creating the <code>ui</code> Package</a></li>
<li><a href="index.html#templates">Templates</a></li>
<li><a href="index.html#registering-a-ui-command">Registering a <code>ui</code> Command</a></li>
<li><a href="index.html#closing">Closing</a></li>
</ul>
</nav>
</div>
</div>
</body>
</html>
<!--
     FILE ARCHIVED ON 14:47:07 Feb 28, 2024 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 03:16:23 Sep 10, 2024.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 0.461
  exclusion.robots: 0.02
  exclusion.robots.policy: 0.01
  esindex: 0.009
  cdx.remote: 8.698
  LoadShardBlock: 2182.847 (3)
  PetaboxLoader3.datanode: 2190.975 (4)
  PetaboxLoader3.resolve: 503.611 (2)
  load_resource: 535.594
-->
